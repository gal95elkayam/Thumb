Index: app/src/main/java/com/example/thumb/LoginActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.thumb;\r\n\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport android.app.ProgressDialog;\r\nimport android.content.Intent;\r\nimport android.content.pm.PackageInfo;\r\n\r\nimport android.content.pm.PackageManager;\r\nimport android.content.pm.Signature;\r\nimport android.os.Bundle;\r\nimport android.util.Base64;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.facebook.AccessToken;\r\nimport com.facebook.CallbackManager;\r\nimport com.facebook.FacebookCallback;\r\nimport com.facebook.FacebookException;\r\nimport com.facebook.FacebookSdk;\r\nimport com.facebook.GraphRequest;\r\nimport com.facebook.GraphResponse;\r\nimport com.facebook.appevents.AppEventsLogger;\r\nimport com.facebook.login.LoginManager;\r\nimport com.facebook.login.LoginResult;\r\nimport com.google.android.gms.auth.api.signin.GoogleSignIn;\r\nimport com.google.android.gms.auth.api.signin.GoogleSignInAccount;\r\nimport com.google.android.gms.auth.api.signin.GoogleSignInClient;\r\nimport com.google.android.gms.auth.api.signin.GoogleSignInOptions;\r\nimport com.google.android.gms.common.api.ApiException;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.firebase.auth.AuthCredential;\r\nimport com.google.firebase.auth.AuthResult;\r\nimport com.google.firebase.auth.FacebookAuthProvider;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.auth.FirebaseUser;\r\nimport com.google.firebase.auth.GoogleAuthProvider;\r\n\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.security.MessageDigest;\r\nimport java.security.NoSuchAlgorithmException;\r\nimport java.util.Arrays;\r\nimport java.util.Collections;\r\n\r\npublic class LoginActivity extends AppCompatActivity {\r\n\r\n    private static final int RC_SIGN_IN = 101;\r\n    private static final int RC_SIGN_IN_facebook = 100;\r\n    private static final String TAG = LoginActivity.class.getSimpleName();\r\n    private Button btnGoogle;\r\n    private Button btnFacebook;\r\n    GoogleSignInClient mGoogleSignInClient;\r\n    private FirebaseAuth mAuth;\r\n    TextView btn;\r\n    EditText inputEmail,inputPassword;\r\n    Button btnLogin;\r\n    private ProgressDialog mLoadingBar;\r\n    //Facebook Declaration\r\n    CallbackManager callbackManager;\r\n    LoginManager loginManager;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_login);\r\n\r\n        printKeyHash();\r\n\r\n        btn=findViewById(R.id.textViewSignUp);\r\n        inputEmail=findViewById(R.id.inputEmail);\r\n        inputPassword=findViewById(R.id.inputPassword);\r\n        btnLogin=findViewById(R.id.btnlogin);\r\n        btnLogin.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                LoginActivity.this.checkCrededentials();\r\n            }\r\n        });\r\n        mLoadingBar=new ProgressDialog(LoginActivity.this);\r\n        btnGoogle=findViewById(R.id.btnGoogle);\r\n        mAuth=FirebaseAuth.getInstance();\r\n        btn.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                startActivity(new Intent(LoginActivity.this,RegisterActivity.class));\r\n            }\r\n        });\r\n        GoogleSignInOptions gso = new GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)\r\n                .requestIdToken(getString(R.string.default_web_client_id))\r\n                .requestEmail()\r\n                .build();\r\n        // Build a GoogleSignInClient with the options specified by gso.\r\n        mGoogleSignInClient = GoogleSignIn.getClient(this, gso);\r\n\r\n        btnGoogle.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                signIn();\r\n\r\n            }\r\n        });\r\n        btnFacebook=findViewById(R.id.btnFacebook);\r\n        FacebookSdk.sdkInitialize(this.getApplicationContext());\r\n        btnFacebook.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                System.out.println(\"TAG=onclick\"+TAG);\r\n                Log.d(TAG, \"facebook:onclick:\");\r\n                signInFacebook();\r\n\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    private void signInFacebook(){\r\n        callbackManager = CallbackManager.Factory.create();\r\n        LoginManager.getInstance().logInWithReadPermissions(LoginActivity.this, Arrays.asList(\"email\",\"public_profile\"));\r\n        System.out.println(\"TAG=signInFacebook\"+TAG);\r\n        System.out.println(\"facebook:callbackManager:\"+callbackManager);\r\n        LoginManager.getInstance().registerCallback(callbackManager, new FacebookCallback<LoginResult>() {\r\n            @Override\r\n            public void onSuccess(LoginResult loginResult) {\r\n                System.out.println(\"TAG=onSuccess\"+TAG);\r\n                Log.i(\"LoginActivity\", \"@@@onSuccess\");\r\n                ////////////////////////////////////////////////////////////////////\r\n                //setContentView(R.layout.activity_main);\r\n                //////////////////////////////////////////////////////////\r\n                handleFacebookAccessToken(loginResult.getAccessToken());\r\n            }\r\n\r\n            @Override\r\n            public void onCancel() {\r\n                Toast.makeText(LoginActivity.this, \"Login Cancel\", Toast.LENGTH_LONG).show();\r\n            }\r\n\r\n            @Override\r\n            public void onError(FacebookException error) {\r\n                Toast.makeText(LoginActivity.this, error.getMessage(), Toast.LENGTH_LONG).show();\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    private void handleFacebookAccessToken(AccessToken token) {\r\n        AuthCredential credential = FacebookAuthProvider.getCredential(token.getToken());\r\n        mAuth.signInWithCredential(credential)\r\n                .addOnCompleteListener(this, new OnCompleteListener<AuthResult>() {\r\n                    @Override\r\n                    public void onComplete(@NonNull Task<AuthResult> task) {\r\n                        if (task.isSuccessful()) {\r\n                            // Sign in success, update UI with the signed-in user's information\r\n                            Log.d(TAG, \"signInWithCredential:success\");\r\n                            FirebaseUser user = mAuth.getCurrentUser();\r\n                            updateUI(user);\r\n                        } else {\r\n                            // If sign in fails, display a message to the user.\r\n                            Log.w(TAG, \"signInWithCredential:failure\", task.getException());\r\n                            Toast.makeText(LoginActivity.this, \"Authentication failed.\",\r\n                                    Toast.LENGTH_SHORT).show();\r\n                            updateUI(null);\r\n                        }\r\n\r\n                        // ...\r\n                    }\r\n                });\r\n    }\r\n\r\n\r\n    private void printKeyHash() {\r\n        try {\r\n            PackageInfo info=getPackageManager().getPackageInfo(\"com.example.thumb\", PackageManager.GET_SIGNATURES);\r\n             for(Signature signature:info.signatures)\r\n             {\r\n                 MessageDigest messageDigest=MessageDigest.getInstance(\"SHA\");\r\n                 messageDigest.update(signature.toByteArray());\r\n                 Log.e(\"KeyHash\", Base64.encodeToString(messageDigest.digest(),Base64.DEFAULT));\r\n\r\n             }\r\n        } catch (PackageManager.NameNotFoundException e) {\r\n            e.printStackTrace();\r\n        } catch (NoSuchAlgorithmException e) {\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n\r\n    private void  checkCrededentials(){\r\n        String email=inputEmail.getText().toString();\r\n        String password=inputPassword.getText().toString();\r\n\r\n        if(email.isEmpty() || !email.contains(\"@\")){\r\n            showError(inputEmail,\"Email is not valid!\");\r\n        }\r\n        else if (password.isEmpty() || password.length()<7){\r\n            showError(inputPassword,\"Password must be 7 character\");\r\n        }\r\n        else {\r\n            mLoadingBar.setTitle(\"Login\");\r\n            mLoadingBar.setMessage(\"Please wait, while check your credentials\");\r\n            mLoadingBar.setCanceledOnTouchOutside(false);\r\n            mLoadingBar.show();\r\n\r\n            mAuth.signInWithEmailAndPassword(email,password).addOnCompleteListener(new OnCompleteListener<AuthResult>() {\r\n                @Override\r\n                public void onComplete(@NonNull Task<AuthResult> task) {\r\n                    if(task.isSuccessful()){\r\n                        mLoadingBar.dismiss();\r\n                        Intent intent=new Intent(LoginActivity.this,MainActivity.class);\r\n                        //, this flag will cause any existing task that would be associated with the activity to be cleared before the activity is started\r\n                        intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK|Intent.FLAG_ACTIVITY_NEW_TASK);\r\n                        startActivity(intent);\r\n                    }\r\n\r\n                }\r\n            });\r\n        }\r\n\r\n\r\n    }\r\n    private void showError(EditText input, String s){\r\n        input.setError(s);\r\n        input.requestFocus();\r\n    }\r\n\r\n    private void signIn() {\r\n        Intent signInIntent = mGoogleSignInClient.getSignInIntent();\r\n        startActivityForResult(signInIntent, RC_SIGN_IN);\r\n    }\r\n\r\n    @Override\r\n    public void onActivityResult(int requestCode, int resultCode, Intent data) {\r\n        super.onActivityResult(requestCode, resultCode, data);\r\n        //for facebook\r\n\r\n//        if(callbackManager.onActivityResult(requestCode, resultCode, data)) {\r\n//            return;\r\n//        }\r\n\r\n        // Result returned from launching the Intent from GoogleSignInApi.getSignInIntent(...);\r\n        if (requestCode == RC_SIGN_IN) {\r\n            Task<GoogleSignInAccount> task = GoogleSignIn.getSignedInAccountFromIntent(data);\r\n            try {\r\n                // Google Sign In was successful, authenticate with Firebase\r\n                GoogleSignInAccount account = task.getResult(ApiException.class);\r\n                assert account != null;\r\n                firebaseAuthWithGoogle(account);\r\n            } catch (ApiException e) {\r\n                // Google Sign In failed, update UI appropriately\r\n                Toast.makeText(this,e.toString(),Toast.LENGTH_SHORT).show();\r\n                // ...\r\n            }\r\n        }\r\n        else {\r\n            if(callbackManager.onActivityResult(requestCode, resultCode, data)){\r\n                return;\r\n            }\r\n\r\n        }\r\n    }\r\n    private void firebaseAuthWithGoogle(GoogleSignInAccount acct) {\r\n        AuthCredential credential = GoogleAuthProvider.getCredential(acct.getIdToken(), null);\r\n        mAuth.signInWithCredential(credential)\r\n                .addOnCompleteListener(this, new OnCompleteListener<AuthResult>() {\r\n                    @Override\r\n                    public void onComplete(@NonNull Task<AuthResult> task) {\r\n                        if (task.isSuccessful()) {\r\n                            // Sign in success, update UI with the signed-in user's information\r\n                            FirebaseUser user = mAuth.getCurrentUser();\r\n                            Toast.makeText(LoginActivity.this,user.getEmail()+user.getDisplayName(),Toast.LENGTH_SHORT).show();\r\n                            updateUI(user);\r\n                        } else {\r\n                            // If sign in fails, display a message to the user.\r\n                            Toast.makeText(LoginActivity.this,task.getException().toString(),Toast.LENGTH_SHORT).show();\r\n                            updateUI(null);\r\n                        }\r\n\r\n                        // ...\r\n                    }\r\n                });\r\n    }\r\n    //where we send the user\r\n    private void updateUI(FirebaseUser user) {\r\n        Intent intent=new Intent(LoginActivity.this,MainActivity.class);\r\n        startActivity(intent);\r\n    }\r\n\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/thumb/LoginActivity.java	(revision 6b055228b781e15976ca15cd1c6658946321555b)
+++ app/src/main/java/com/example/thumb/LoginActivity.java	(date 1607418260428)
@@ -1,6 +1,4 @@
 package com.example.thumb;
-
-
 import androidx.annotation.NonNull;
 import androidx.appcompat.app.AppCompatActivity;
 import android.app.ProgressDialog;
